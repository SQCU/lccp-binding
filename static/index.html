<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logit Loom Client</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Logit Loom Client</h1>
        
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button id="tab-btn-multi-stream" class="tab-btn active">Multi-Stream Generator</button>
            <button id="tab-btn-ngram" class="tab-btn">Context Slice Explorer</button>
        </div>

        <!-- Tab Content Panes -->
        <div class="tab-content">

            <!-- Pane 1: Multi-Stream Generator (Unchanged) -->
            <div id="pane-multi-stream" class="tab-pane active">
                <p>Generate multiple, parallel text streams from chained prompts.</p>
                <div class="input-area">
                    <div id="prompts-container">
                        <textarea id="main-prompt" class="prompt-input" rows="4" placeholder="Enter your primary prompt here..."></textarea>
                    </div>
                    <div class="controls">
                        <button id="half-ctx-btn">+ Half Context</button>
                        <button id="generate-btn">Generate All Streams</button>
                    </div>
                </div>
                <div id="streams-container"></div>
            </div>

            <!-- Pane 2: Context Slice Logit Explorer -->
            <div id="pane-ngram" class="tab-pane">
                <p>
                    Input a phrase to see how the model's next-token predictions change as its context is reduced, or process the logits to create a new sampling distribution.
                </p>
                <div class="input-area">
                     <textarea id="ngram-input" class="prompt-input" rows="5" placeholder="Type a word or phrase..."></textarea>
                     <div class="controls">
                         <button id="ngram-probe-btn">Probe Context Slices</button>
                         <!-- ⭐ NEW: Autoregress Stop Button -->
                         <button id="stop-autoregress-btn" style="display: none;">Stop Autoregression</button>
                    </div>
                </div>
                
                <!-- ⭐ UPDATED: Sampling Controls with Progressive Toggles -->
                <div class="sampling-controls-container">
                     <div class="toggle-switch-group">
                         <label class="switch">
                             <input type="checkbox" id="process-logit-toggle">
                             <span class="slider-toggle"></span>
                         </label>
                         <label for="process-logit-toggle" class="switch-label">[PROCESS LOGIT]</label>
                     </div>
                     <div id="mmm-slider-container" class="slider-group disabled">
                        <label for="mmm-slider" id="mmm-label">Markov Momentum Multiplier: 1.00</label>
                        <input type="range" id="mmm-slider" min="-5.0" max="5.0" value="1.0" step="0.01">
                     </div>
                     <div id="sample-logit-toggle-group" class="toggle-switch-group disabled">
                         <label class="switch">
                             <input type="checkbox" id="sample-logit-toggle">
                             <span class="slider-toggle"></span>
                         </label>
                         <label for="sample-logit-toggle" class="switch-label">[SAMPLE LOGIT]</label>
                     </div>
                      <div id="autoregress-toggle-group" class="toggle-switch-group disabled">
                         <label class="switch">
                             <input type="checkbox" id="autoregress-toggle">
                             <span class="slider-toggle"></span>
                         </label>
                         <label for="autoregress-toggle" id="autoregress-label" class="switch-label">[ AUTOREGRESS ]</label>
                     </div>
                </div>

                <!-- ⭐ NEW: Autoregress Config Panel -->
                <div id="autoregress-panel" class="config-panel">
                    <h3>Autoregress Settings</h3>
                    <div class="slider-group">
                        <label for="max-continuation-input" id="max-continuation-label">Max Continuation Length: 256</label>
                        <input type="number" id="max-continuation-input" value="256" class="simple-input">
                    </div>
                </div>


                <!-- Probe Parameters -->
                <div class="probe-params-container">
                    <h3>Probe Parameters</h3>
                    <div class="slider-group">
                        <label for="num-slices-slider" id="num-slices-label">Number of Slices: 4</label>
                        <input type="range" id="num-slices-slider" min="2" max="7" value="4" step="1">
                    </div>
                    <div class="slider-group">
                        <label for="momentum-p-mass-slider" id="momentum-p-mass-label">P-Mass Filter: 0.9000</label>
                        <input type="range" id="momentum-p-mass-slider" min="0" max="1.0" value="0.95" step="0.001">
                    </div>
                </div>

                <!-- Filter Controls -->
                <div id="filter-controls" class="filter-controls-container">
                    <h3>Filter Controls</h3>
                    <!-- Sample Button is now here -->
                    <div id="sample-logit-container" class="disabled">
                        <button id="sample-logit-btn">[SAMPLE LOGIT]</button>
                    </div>
                    <div class="slider-group">
                        <label for="top-k-slider" id="top-k-label">Top-K: 1000</label>
                        <input type="range" id="top-k-slider" min="1" max="1000" value="1000">
                    </div>
                    <div class="slider-group">
                        <label for="top-p-slider" id="top-p-label">Top-P: 1.00</label>
                        <input type="range" id="top-p-slider" min="0.01" max="1.0" value="1.0" step="0.01">
                    </div>
                    <div class="slider-group">
                        <label for="min-p-slider" id="min-p-label">Min-P: 0.00%</label>
                        <input type="range" id="min-p-slider" min="0" max="0.1" value="0" step="0.0001">
                    </div>
                </div>

                <div id="ngram-results-container">
                    <!-- Results will be rendered here -->
                </div>
            </div>

        </div>
    </div>
    <script src="/static/main.js"></script>
</body>
</html>